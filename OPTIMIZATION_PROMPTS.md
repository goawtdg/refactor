# 优化方向提示词（简体中文）

## 性能优化

1. 按代码块长度分组，只比较长度相近的块，减少50-80%的比较次数
2. 使用哈希值预过滤明显不同的代码块，避免不必要的相似度计算
3. 优化SequenceMatcher调用，先用quick_ratio快速过滤，只有接近阈值时才计算精确的ratio
4. 将skip_children中的list.index()替换为字典映射，将O(n²)复杂度降为O(n)
5. 预先计算并缓存ancestor关系，避免在循环中重复计算
6. 使用列表收集代码片段，最后一次性拼接，减少字符串拼接的内存分配
7. 使用multiprocessing并行比较代码块，在多核CPU上获得4-8倍性能提升
8. 建立block到索引的映射字典，避免重复的index查找操作

## 跨平台兼容性

9. 使用os.makedirs()替代mkdir -p命令，实现跨平台目录创建
10. 使用shutil.rmtree()替代rm -rf命令，实现跨平台目录删除
11. 使用Python文件操作替代cat命令，实现跨平台文件合并
12. 使用difflib或subprocess替代外部diff命令，实现跨平台差异生成
13. 使用tempfile.gettempdir()替代硬编码的/tmp路径，支持Windows系统
14. 使用pathlib.Path和os.path.sep处理路径，支持Windows路径分隔符

## 错误处理与修复

15. 修复第108行的IndexError，在访问line[indent]前检查indent是否小于行长度
16. 修复第303行的字符串迭代错误，直接打印b.code或使用split('\n')逐行打印
17. 修复第198行的逻辑错误，返回None而不是0当stack为空时
18. 为所有文件读写操作添加try-except异常处理
19. 检查os.system()的返回值，处理命令执行失败的情况
20. 在process_py函数中添加stack为空的检查，防止IndexError
21. 使用encoding='utf-8'和errors='ignore'打开文件，处理编码错误

## 减少误报优化

22. 实现代码标准化函数，移除空白字符和注释后再比较相似度
23. 提取代码结构特征（关键字、操作符、控制流），计算结构相似度
24. 分析变量名和函数名的语义相似度，过滤语义完全不同的代码块
25. 计算代码块的实际差异比例，如果差异过大则判定为误报
26. 根据代码块大小动态调整相似度阈值，小代码块使用更高阈值
27. 使用多指标综合判断（标准化相似度50%+结构相似度25%+语义相似度15%+差异比例10%）
28. 添加最小语义相似度参数，如果语义相似度太低则判定为误报
29. 分析代码块的上下文（父块代码），提高判断准确性

## 代码结构优化

30. 将全局变量封装到类中，使用CodeParser类管理解析状态
31. 将比较逻辑封装到BlockComparator类，提高代码可测试性
32. 将HTML生成逻辑封装到HTMLReporter类，实现职责分离
33. 使用配置类或字典管理所有参数，支持配置文件加载
34. 将文件处理逻辑封装到FileProcessor类，减少全局状态污染

## 功能增强

35. 使用tqdm库显示处理进度条和预计完成时间
36. 支持JSON格式输出，方便程序化处理结果
37. 支持终端彩色输出，使用colorama库实现跨平台彩色显示
38. 在HTML报告中使用Pygments进行语法高亮，提高可读性
39. 添加可折叠的HTML报告区块，方便浏览大量相似代码
40. 在HTML报告中添加摘要头部，显示统计信息和过滤选项
41. 改进Python解析，正确处理多行字符串和装饰器
42. 改进C/C++解析，正确处理预处理指令和模板语法
43. 添加Java语言解析支持，修复已知的解析错误

## 内存优化

44. 对于大文件使用流式处理，避免一次性加载整个文件到内存
45. 在比较完成后及时释放不需要的block对象的code属性
46. 使用生成器而不是列表存储大量代码块，减少内存占用

## 代码质量

47. 添加单元测试覆盖各种边界情况（空文件、单行文件、大文件）
48. 添加集成测试验证跨平台兼容性（Windows、Linux、macOS）
49. 添加性能基准测试，监控优化效果
50. 使用类型提示（type hints）提高代码可读性和IDE支持

